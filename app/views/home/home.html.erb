
<script>
  var dispatcher = new WebSocketRails("evening-stream-72370.herokuapp.com/websocket");
  var form = document.getElementById("form");
  var mouse_x, mouse_y, d_motion;

  var getDevice = (function(){
    var ua = navigator.userAgent;
    if(ua.indexOf('iPhone') > 0 || ua.indexOf('iPod') > 0 || ua.indexOf('Android') > 0 && ua.indexOf('Mobile') > 0){
      window.addEventListener("devicemotion", function(e){
        d_motion = Number(e.rotationRate.alpha).toFixed(5);
      });
    }else if(ua.indexOf('iPad') > 0 || ua.indexOf('Android') > 0){
      return 'tab';
    }else{
      document.body.addEventListener('mousemove', function(e){
        mouse_x = e.pageX;
        mouse_y = e.pageY;
      }, false);
    }
  })();

  getMousePosition();

  function getMousePosition(){
    dispatcher.trigger("send_message", {x: mouse_x, y: mouse_y, d: d_motion});
    requestAnimationFrame(getMousePosition);
  }

  dispatcher.bind("send", function(data) {
    console.log(data.message);
  });
</script>